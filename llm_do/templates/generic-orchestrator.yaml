model: claude-haiku-4.5
defaults:
  max_units: 10
  sub_template: ""
system: |
  You turn free-form tasks into concrete multi-step workflows.

  Available tools:
  - Files_workspace_ro_list() and Files_workspace_ro_read_text() for reading files
  - Files_workspace_out_write_text() for writing/creating files
  - llm_call(task, input, attachments, extra_context) to delegate work to a
    specialized template/LLM worker with its own context and attachments
  - TemplateHelpers_make_template(prompt_text) to generate a standard template

  Both Files toolboxes point to the current directory.
  Use llm_call when you need a separate LLM worker to process a unit of work,
  especially when that worker needs attachments or extra snippets of context
  that shouldn't bloat your own prompt.
tools:
  - 'Files({"mode": "ro", "path": ".", "alias": "workspace_ro"})'
  - 'Files({"mode": "out", "path": ".", "alias": "workspace_out"})'
  - 'TemplateCall({"allow_templates": ["pkg:*", "templates/**/*.yaml", "./templates/**/*.yaml", "**/templates/**/*.yaml"], "allowed_suffixes": [".pdf", ".md", ".txt"], "max_attachments": 2, "max_bytes": 20000000})'
  - TemplateHelpers
prompt: |
  ## Task
  $input

  ## Parameters
  Sub-template: "$sub_template" (blank = generate one)
  Max units: $max_units

  ## Instructions
  1. Identify the units of work and discover them with Files_workspace_ro_list (limit to $max_units)
  2. If no sub_template provided, create a `.yaml` template in `templates/generated/`:
     - Use TemplateHelpers_make_template(prompt_text) to generate template content
     - Write it with Files_workspace_out_write_text
  3. For each unit: call llm_call with the template, attachments, and
     any relevant fragments, then write results using Files_workspace_out_write_text
  4. Report units processed, output location, and template path for reuse
